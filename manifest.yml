---
# Parallel builds can be enabled by pushing apps separately or using CF CLI with --strategy flag
# Example: cf push --strategy rolling

# Variables used in routes:
# - SPACE_NAME: Space name (e.g., "dev", "test", "prod")
# - DOMAIN: Domain name (e.g., "cfapps.example.com")
# 
# Provide variables when deploying:
#   cf push --var SPACE_NAME=your-space-name --var DOMAIN=your-domain.com
# Or use a vars file:
#   cf push --vars-file vars.yml
#
# Example vars.yml:
#   SPACE_NAME: dev
#   DOMAIN: cfapps.example.com

applications:
# UI Application - Only app with public routes
- name: service-tester-ui
  memory: 512M
  instances: 1
  buildpack: python_buildpack
  command: python app.py
  random-route: true
  host: service-tester
  env:
    PYTHONUNBUFFERED: 1
    APP_TYPE: ui

# PostgreSQL application - Has route for internal communication
- name: service-tester-postgres
  memory: 512M
  instances: 1
  buildpack: python_buildpack
  command: python app.py
  routes:
  - route: service-tester-postgres-((SPACE_NAME)).((DOMAIN))
  env:
    PYTHONUNBUFFERED: 1
    APP_TYPE: backend
  services:
    - service-tester-postgres

# MySQL application - Has route for internal communication
- name: service-tester-mysql
  memory: 512M
  instances: 1
  buildpack: python_buildpack
  command: python app.py
  routes:
  - route: service-tester-mysql-((SPACE_NAME)).((DOMAIN))
  env:
    PYTHONUNBUFFERED: 1
    APP_TYPE: backend
  services:
    - service-tester-mysql

# RabbitMQ application - Has route for internal communication
- name: service-tester-rabbitmq
  memory: 512M
  instances: 1
  buildpack: python_buildpack
  command: python app.py
  routes:
  - route: service-tester-rabbitmq-((SPACE_NAME)).((DOMAIN))
  env:
    PYTHONUNBUFFERED: 1
    APP_TYPE: backend
  services:
    - service-tester-rabbitmq

# Valkey application - Has route for internal communication
- name: service-tester-valkey
  memory: 512M
  instances: 1
  buildpack: python_buildpack
  command: python app.py
  routes:
  - route: service-tester-valkey-((SPACE_NAME)).((DOMAIN))
  env:
    PYTHONUNBUFFERED: 1
    APP_TYPE: backend
  services:
    - service-tester-valkey

